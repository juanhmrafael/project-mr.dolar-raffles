<!-- Modal Container - Solo se renderiza cuando está abierto -->
@if (isOpen()) {

<!-- Backdrop con animación mejorada -->
<div
    (click)="onBackdropClick()"
    class="fixed inset-0 z-modal-backdrop bg-black/75 backdrop-blur-sm animate-fade-in"
    aria-hidden="true"
></div>

<!-- Contenedor de posicionamiento responsivo -->
<div [ngClass]="containerClasses()">
    <!-- Panel principal del Modal con animaciones mejoradas -->
    <div
        #modalPanel
        [ngClass]="modalClasses()"
        (click)="$event.stopPropagation()"
        class="flex flex-col animate-bounce-in-modern transform-gpu"
        role="dialog"
        aria-modal="true"
        [attr.aria-labelledby]="title() ? 'modal-title' : null"
        [attr.aria-describedby]="title() ? null : 'modal-content'"
    >
        <!-- Header del Modal sin gradientes que rompan bordes -->
        <header
            class="flex items-center justify-between p-6 pb-4 shrink-0 border-b border-border/30 bg-muted/5 rounded-t-2xl"
        >
            @if (title()) {
            <div class="flex items-center gap-3">
                <!-- Indicador visual mejorado -->
                <div
                    class="w-1 h-7 bg-primary rounded-full shadow-glow-soft animate-pulse-glow-modern"
                ></div>
                <h2
                    id="modal-title"
                    class="text-xl sm:text-2xl font-bold text-foreground tracking-tight animate-slide-in-left"
                >
                    {{ title() }}
                </h2>
            </div>
            } @else {
            <div></div>
            }

            <!-- Botón de cierre con color destructive -->
            <button
                type="button"
                (click)="close()"
                class="group flex items-center justify-center w-11 h-11 rounded-xl text-destructive/70 hover:text-destructive hover:bg-destructive/10 border border-transparent hover:border-destructive/20 transition-all duration-moderate ease-bounce focus:outline-none focus:ring-2 focus:ring-destructive focus:ring-offset-2 hover:scale-110 active:scale-95 animate-slide-in-right"
                aria-label="Cerrar modal"
            >
                <lucide-icon
                    name="X"
                    class="w-5 h-5 transition-all duration-moderate ease-bounce group-hover:rotate-90 group-hover:scale-110"
                ></lucide-icon>
            </button>
        </header>

        <!-- Contenido principal con scroll mejorado -->
        <main
            id="modal-content"
            class="flex-1 p-6 overflow-y-auto overscroll-contain scroll-smooth animate-slide-up"
            style="
                scrollbar-width: thin;
                scrollbar-color: hsl(var(--primary) / 0.3) transparent;
            "
        >
            <ng-content></ng-content>
        </main>

        <!-- Footer sin gradientes que rompan bordes -->
        <footer
            class="shrink-0 p-6 pt-4 [&:has(*:not(:empty))]:border-t [&:has(*:not(:empty))]:border-border/30 [&:has(*:not(:empty))]:bg-muted/5 rounded-b-2xl animate-slide-up"
        >
            <ng-content select="[modal-footer]"></ng-content>
        </footer>
    </div>
</div>
}
