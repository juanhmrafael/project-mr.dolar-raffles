// .devcontainer/backend/devcontainer.json
{
    // Propósito: Un nombre descriptivo para el entorno de desarrollo que aparecerá en la interfaz de VS Code.
    "name": "Django Backend (Dev Environment)",
    // Propósito: La directiva clave. Le dice a VS Code que use Docker Compose para orquestar el entorno.
    // Apunta al archivo docker-compose.yml que define nuestros servicios.
    "dockerComposeFile": "docker-compose.yml",
    // Propósito: Especifica a cuál de los servicios definidos en el docker-compose.yml debe
    // "adjuntarse" VS Code. Este será nuestro contenedor principal de desarrollo.
    "service": "backend",
    // Propósito: Define el directorio de trabajo por defecto que se abrirá en VS Code y en su terminal.
    // Debe coincidir con la ruta donde se monta el código de la aplicación.
    "workspaceFolder": "/workspaces/backend",
    // Propósito: Define el usuario con el que se ejecutarán los procesos dentro del contenedor.
    // Se usa 'root' en desarrollo para evitar cualquier problema de permisos con los archivos
    // montados desde el host, facilitando una experiencia de desarrollo sin fricciones.
    "remoteUser": "root",
    "forwardPorts": [
        8000,
        5432
    ],
    // Propósito: Contiene todas las personalizaciones específicas de VS Code que se aplicarán
    // únicamente dentro de este Dev Container.
    "customizations": {
        "vscode": {
            // Propósito: Define configuraciones específicas (equivalente a settings.json)
            // que se aplicarán para este entorno.
            "settings": {
                // Propósito: Ayuda a VS Code a localizar el intérprete de Python correcto
                // dentro del contenedor para activar el autocompletado, linting y debugging.
                "python.defaultInterpreterPath": "/usr/local/bin/python",
                // Propósito: Habilita la integración con el linter Ruff.
                "python.linting.ruffEnabled": true,
                // Propósito: Desactiva otros proveedores de formato para asegurar que Ruff sea el único.
                "python.formatting.provider": "none",
                // Propósito: Define configuraciones específicas por lenguaje.
                "[python]": {
                    // Propósito: Establece a Ruff como el formateador de código por defecto para Python.
                    "editor.defaultFormatter": "charliermarsh.ruff",
                    // Propósito: Activa el formateo automático cada vez que se guarda un archivo.
                    "editor.formatOnSave": true
                },
                // Propósito: Define acciones que se ejecutan al guardar.
                "editor.codeActionsOnSave": {
                    // Propósito: Ejecuta el auto-fix de Ruff para corregir errores automáticamente.
                    "source.fixAll": "explicit",
                    // Propósito: Organiza y ordena los 'imports' automáticamente al guardar.
                    "source.organizeImports": "explicit"
                },
                // Propósito: Habilita el soporte para descubrir y ejecutar tests con Pytest.
                "python.testing.pytestEnabled": true,
                "python.testing.pytestArgs": [
                    "tests/"
                ], // Propósito: Forzar la asociación de tipos de archivo específicos a un lenguaje concreto.
                "files.associations": {
                    // Regla: Tratar todos los archivos que terminen en .html como archivos del tipo 'django-html'.
                    // Esto activará el resaltado de sintaxis, los snippets y la inteligencia
                    // proporcionados por la extensión "batisteo.vscode-django" para estos archivos.
                    "**/*.html": "django-html"
                }, // Propósito: Define configuraciones específicas para las plantillas de Django.
                // Esto asegura que las reglas de formato se apliquen solo a estos archivos.
                "[django-html]": {
                    // Propósito: Establece a 'djlint' como el formateador por defecto para los archivos
                    // identificados como 'django-html'.
                    "editor.defaultFormatter": "monosans.djlint",
                    // Propósito: (Recomendado) Activa el formateo automático cada vez que se guarda
                    // un archivo de plantilla, manteniendo la consistencia sin esfuerzo.
                    "editor.formatOnSave": true
                }
            },
            // Propósito: Lista de extensiones de VS Code que se instalarán automáticamente
            // dentro del Dev Container, manteniendo el VS Code local limpio.
            "extensions": [
                // --- Esenciales de Python ---
                // Proporcionan el soporte base, el mejor autocompletado y el depurador. No negociables.
                "ms-python.python",
                "ms-python.vscode-pylance",
                "ms-python.debugpy",
                // --- Calidad de Código y Framework ---
                // Herramientas para mantener el código limpio, consistente y adaptado a Django.
                "charliermarsh.ruff", // Linter y formateador ultra-rápido. El nuevo estándar.
                "batisteo.vscode-django", // Snippets y resaltado de sintaxis para plantillas de Django.
                "monosans.djlint", // Linter y formateador estándar para plantillas Django.
                "njpwerner.autodocstring", // (Añadida) Genera plantillas de docstrings para funciones y clases. Ahorra mucho tiempo.
                "kevinrose.vsc-python-indent", // Mejora la indentación automática de Python.
                "tamasfe.even-better-toml", // Excelente soporte para archivos .toml (como pyproject.toml).
                // --- Productividad y Herramientas de Desarrollo ---
                // Utilidades que aceleran drásticamente el flujo de trabajo diario.
                "eamodio.gitlens", // (Añadida) Superpoderes para Git. Permite ver el historial de código línea por línea.
                "humao.rest-client", // (Añadida) Permite ejecutar peticiones HTTP/API desde un archivo .http. Ideal para probar tu API de Django.
                "gruntfuggly.todo-tree", // (Añadida) Encuentra y muestra tus comentarios TODO/FIXME en un panel lateral.
                "mikestead.dotenv", // (Añadida) Resaltado de sintaxis para tus archivos .env.
                "mutantdino.resourcemonitor" // Muestra el uso de CPU/RAM del contenedor en la barra de estado.
            ]
        }
    }
}